<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Epigno Tech Blog</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="The [content module](https://content.nuxtjs.org/) is a git files based headless CMS that provides powerful features when it comes to write blogs, documentation sites or just adding content to any regular website. In this post we will go through most of the benefits of this module and discover how we can create a blog with it."><meta data-n-head="ssr" data-hid="i18n-og" property="og:locale" content="en"><meta data-n-head="ssr" data-hid="i18n-og-alt-ja" property="og:locale:alternate" content="ja"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" data-hid="i18n-alt-ja" rel="alternate" href="/blog/testing-with-flask" hreflang="ja"><link data-n-head="ssr" data-hid="i18n-alt-en" rel="alternate" href="/en/blog/testing-with-flask" hreflang="en"><link data-n-head="ssr" data-hid="i18n-xd" rel="alternate" href="/blog/testing-with-flask" hreflang="x-default"><link data-n-head="ssr" data-hid="i18n-can" rel="canonical" href="/en/blog/testing-with-flask"><link rel="preload" href="/_nuxt/ad43ec5.js" as="script"><link rel="preload" href="/_nuxt/6f44278.js" as="script"><link rel="preload" href="/_nuxt/2c6fc93.js" as="script"><link rel="preload" href="/_nuxt/beb60f5.js" as="script"><link rel="preload" href="/_nuxt/f1915da.js" as="script"><style data-vue-ssr-id="38dfa7e4:0 0623093e:0 fa7ff0ca:0 56b15182:0 083745fe:0 54d81fc0:0">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.container{width:100%}@media (min-width:320px){.container{max-width:320px}}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1351px){.container{max-width:1351px}}.bg-black{--bg-opacity:1;background-color:#000;background-color:rgba(0,0,0,var(--bg-opacity))}.bg-blue-500{--bg-opacity:1;background-color:#4299e1;background-color:rgba(66,153,225,var(--bg-opacity))}.border-gray-500{--border-opacity:1;border-color:#a0aec0;border-color:rgba(160,174,192,var(--border-opacity))}.rounded-full{border-radius:9999px}.border{border-width:1px}.border-t-2{border-top-width:2px}.flex{display:flex}.table{display:table}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.self-center{align-self:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.font-medium{font-weight:500}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-48{height:12rem}.h-full{height:100%}.text-sm{font-size:.875rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-4xl{font-size:2.25rem}.text-6xl{font-size:4rem}.m-4{margin:1rem}.m-8{margin:2rem}.mr-2{margin-right:.5rem}.mb-2{margin-bottom:.5rem}.mr-3{margin-right:.75rem}.mt-4{margin-top:1rem}.mb-4{margin-bottom:1rem}.mt-8{margin-top:2rem}.mr-8{margin-right:2rem}.mt-16{margin-top:4rem}.-mb-3{margin-bottom:-.75rem}.object-cover{-o-object-fit:cover;object-fit:cover}.overflow-y-scroll{overflow-y:scroll}.p-4{padding:1rem}.p-6{padding:1.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.static{position:static}.absolute{position:absolute}.relative{position:relative}.top-32{top:32px}.right-32{right:32px}.left-32{left:32px}.top-3rem{top:3rem}.right-3rem{right:3rem}.shadow-sm{box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}.hover\:shadow-md:hover{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.text-center{text-align:center}.text-white{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.text-gray-600{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.uppercase{text-transform:uppercase}.hover\:underline:hover{text-decoration:underline}.tracking-wider{letter-spacing:.05em}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.w-full{width:100%}.w-screen{width:100vw}.transition-colors{transition-property:background-color,border-color,color,fill,stroke}.transition-shadow{transition-property:box-shadow}.ease-linear{transition-timing-function:linear}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-150{transition-duration:.15s}.duration-300{transition-duration:.3s}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}.nuxt-content-highlight{position:relative}.nuxt-content-highlight .filename{position:absolute;right:0;--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity));font-weight:300;z-index:10;margin-right:.5rem;margin-top:.25rem;font-size:.875rem}@media (min-width:320px){.xs\:container{width:100%}}@media (min-width:320px) and (min-width:320px){.xs\:container{max-width:320px}}@media (min-width:320px) and (min-width:640px){.xs\:container{max-width:640px}}@media (min-width:320px) and (min-width:768px){.xs\:container{max-width:768px}}@media (min-width:320px) and (min-width:1024px){.xs\:container{max-width:1024px}}@media (min-width:320px) and (min-width:1280px){.xs\:container{max-width:1280px}}@media (min-width:320px) and (min-width:1351px){.xs\:container{max-width:1351px}}@media (min-width:320px){.xs\:flex-col{flex-direction:column}.xs\:h-84{height:22rem}.xs\:mb-6{margin-bottom:1.5rem}.xs\:py-8{padding-top:2rem;padding-bottom:2rem}.xs\:px-8{padding-left:2rem;padding-right:2rem}.xs\:w-full{width:100%}}@media (min-width:640px){.sm\:container{width:100%}}@media (min-width:640px) and (min-width:320px){.sm\:container{max-width:320px}}@media (min-width:640px) and (min-width:640px){.sm\:container{max-width:640px}}@media (min-width:640px) and (min-width:768px){.sm\:container{max-width:768px}}@media (min-width:640px) and (min-width:1024px){.sm\:container{max-width:1024px}}@media (min-width:640px) and (min-width:1280px){.sm\:container{max-width:1280px}}@media (min-width:640px) and (min-width:1351px){.sm\:container{max-width:1351px}}@media (min-width:768px){.md\:container{width:100%}}@media (min-width:768px) and (min-width:320px){.md\:container{max-width:320px}}@media (min-width:768px) and (min-width:640px){.md\:container{max-width:640px}}@media (min-width:768px) and (min-width:768px){.md\:container{max-width:768px}}@media (min-width:768px) and (min-width:1024px){.md\:container{max-width:1024px}}@media (min-width:768px) and (min-width:1280px){.md\:container{max-width:1280px}}@media (min-width:768px) and (min-width:1351px){.md\:container{max-width:1351px}}@media (min-width:768px){.md\:mb-12{margin-bottom:3rem}.md\:w-1\/2{width:50%}.md\:w-1\/3{width:33.333333%}}@media (min-width:1024px){.lg\:container{width:100%}}@media (min-width:1024px) and (min-width:320px){.lg\:container{max-width:320px}}@media (min-width:1024px) and (min-width:640px){.lg\:container{max-width:640px}}@media (min-width:1024px) and (min-width:768px){.lg\:container{max-width:768px}}@media (min-width:1024px) and (min-width:1024px){.lg\:container{max-width:1024px}}@media (min-width:1024px) and (min-width:1280px){.lg\:container{max-width:1280px}}@media (min-width:1024px) and (min-width:1351px){.lg\:container{max-width:1351px}}@media (min-width:1024px){.lg\:flex-row{flex-direction:row}.lg\:flex-1{flex:1 1 0%}.lg\:h-full{height:100%}.lg\:h-screen{height:100vh}.lg\:overflow-hidden{overflow:hidden}.lg\:px-16{padding-left:4rem;padding-right:4rem}.lg\:py-32{padding-top:8rem;padding-bottom:8rem}.lg\:w-1\/2{width:50%}}@media (min-width:1280px){.xl\:container{width:100%}}@media (min-width:1280px) and (min-width:320px){.xl\:container{max-width:320px}}@media (min-width:1280px) and (min-width:640px){.xl\:container{max-width:640px}}@media (min-width:1280px) and (min-width:768px){.xl\:container{max-width:768px}}@media (min-width:1280px) and (min-width:1024px){.xl\:container{max-width:1024px}}@media (min-width:1280px) and (min-width:1280px){.xl\:container{max-width:1280px}}@media (min-width:1280px) and (min-width:1351px){.xl\:container{max-width:1351px}}@media (min-width:1351px){.xxlmin\:container{width:100%}}@media (min-width:1351px) and (min-width:320px){.xxlmin\:container{max-width:320px}}@media (min-width:1351px) and (min-width:640px){.xxlmin\:container{max-width:640px}}@media (min-width:1351px) and (min-width:768px){.xxlmin\:container{max-width:768px}}@media (min-width:1351px) and (min-width:1024px){.xxlmin\:container{max-width:1024px}}@media (min-width:1351px) and (min-width:1280px){.xxlmin\:container{max-width:1280px}}@media (min-width:1351px) and (min-width:1351px){.xxlmin\:container{max-width:1351px}}@media (min-width:1351px){.xxlmin\:w-1\/2{width:50%}}@media (max-width:1350px){.xxlmax\:container{width:100%}}@media (max-width:1350px) and (min-width:320px){.xxlmax\:container{max-width:320px}}@media (max-width:1350px) and (min-width:640px){.xxlmax\:container{max-width:640px}}@media (max-width:1350px) and (min-width:768px){.xxlmax\:container{max-width:768px}}@media (max-width:1350px) and (min-width:1024px){.xxlmax\:container{max-width:1024px}}@media (max-width:1350px) and (min-width:1280px){.xxlmax\:container{max-width:1280px}}@media (max-width:1350px) and (min-width:1351px){.xxlmax\:container{max-width:1351px}}@media (max-width:1350px){.xxlmax\:flex-col{flex-direction:column}.xxlmax\:w-full{width:100%}}code[class*=language-],pre[class*=language-]{text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono,monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:#363636}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#363636}:not(pre)>code[class*=language-]{white-space:normal;border-radius:.2em;padding:.1em}pre[class*=language-]{overflow:auto;position:relative;margin:.5em 0;padding:1.25em 1em}.language-css>code,.language-sass>code,.language-scss>code{color:#fd9170}[class*=language-] .namespace{opacity:.7}.token.atrule{color:#c792ea}.token.attr-name{color:#ffcb6b}.token.attr-value,.token.attribute{color:#c3e88d}.token.boolean{color:#c792ea}.token.builtin{color:#ffcb6b}.token.cdata,.token.char{color:#80cbc4}.token.class{color:#ffcb6b}.token.class-name,.token.color{color:#f2ff00}.token.comment{color:#546e7a}.token.constant{color:#c792ea}.token.deleted{color:#f07178}.token.doctype{color:#546e7a}.token.entity{color:#f07178}.token.function{color:#c792ea}.token.hexcode{color:#f2ff00}.token.id,.token.important{color:#c792ea;font-weight:700}.token.inserted{color:#80cbc4}.token.keyword{color:#c792ea;font-style:italic}.token.number{color:#fd9170}.token.operator{color:#89ddff}.token.prolog{color:#546e7a}.token.property{color:#80cbc4}.token.pseudo-class,.token.pseudo-element{color:#c3e88d}.token.punctuation{color:#89ddff}.token.regex{color:#f2ff00}.token.selector{color:#f07178}.token.string{color:#c3e88d}.token.symbol{color:#c792ea}.token.tag,.token.unit{color:#f07178}.token.url{color:#fd9170}.token.variable{color:#f07178}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}html{font-family:"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box}*,:after,:before{box-sizing:border-box;margin:0}.nuxt-content p{margin-bottom:20px}.nuxt-content h2{font-weight:700;font-size:28px}.nuxt-content h3{font-weight:700;font-size:22px}.icon.icon-link{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ij48cGF0aCBjbGFzcz0iaGVyb2ljb24tdWkiIGQ9Ik0xMS4wMyA4aDMuOTRsMS4wNi00LjI0YTEgMSAwIDEgMSAxLjk0LjQ4TDE3LjAzIDhIMjBhMSAxIDAgMCAxIDAgMmgtMy40N2wtMSA0SDE4YTEgMSAwIDEgMSAwIDJoLTIuOTdsLTEuMDYgNC4yNWExIDEgMCAxIDEtMS45NC0uNDlsLjk0LTMuNzZIOS4wM2wtMS4wNiA0LjI1YTEgMSAwIDEgMS0xLjk0LS40OUw2Ljk3IDE2SDRhMSAxIDAgMCAxIDAtMmgzLjQ3bDEtNEg2YTEgMSAwIDAgMSAwLTJoMi45N2wxLjA2LTQuMjRhMSAxIDAgMSAxIDEuOTQuNDhMMTEuMDMgOHptLS41IDJsLTEgNGgzLjk0bDEtNGgtMy45NHoiLz48L3N2Zz4K);display:inline-block;width:20px;height:20px;background-size:20px 20px}.logo[data-v-4c237d0b]{height:40px}</style><link rel="preload" href="/_nuxt/static/1606899476/en/blog/testing-with-flask/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1606899476/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><article class="flex lg:h-screen w-screen lg:overflow-hidden xs:flex-col lg:flex-row"><div class="relative lg:w-1/2 xs:w-full xs:h-84 lg:h-full post-left bg-black"><img class="absolute h-full w-full object-cover"> <div class="overlay"></div> <div class="absolute top-32 left-32 text-white"><div class="flex"><a href="/en" class="nuxt-link-active"><img src="/_nuxt/img/logo_green_e.b67e3e6.svg" alt="Epigno Logo" class="logo" data-v-4c237d0b></a> <h1 class="font-bold text-xl py-1 px-3">Epigno Tech Blog</h1></div> <div class="mt-16 -mb-3 flex uppercase text-sm"><p class="mr-3">
          August 1, 2018
        </p> <span class="mr-3">•</span> <p>Malik Olivier Boussejra</p></div> <h1 class="text-6xl font-bold">Testing with flask</h1> <span><a href="/en/blog/tag/python"><span class="truncate uppercase tracking-wider font-medium text-ss px-2 py-1 rounded-full mr-2 mb-2 border border-light-border dark:border-dark-border transition-colors duration-300 ease-linear">
            python
          </span></a></span><span><a href="/en/blog/tag/web_development"><span class="truncate uppercase tracking-wider font-medium text-ss px-2 py-1 rounded-full mr-2 mb-2 border border-light-border dark:border-dark-border transition-colors duration-300 ease-linear">
            web development
          </span></a></span></div> <div class="flex absolute top-3rem right-3rem"><a href="https://epigno.jp" class="mr-8 self-center text-white font-bold hover:underline">
        Epigno
      </a> </div></div> <div class="relative xs:py-8 xs:px-8 lg:py-32 lg:px-16 lg:w-1/2 xs:w-full h-full overflow-y-scroll markdown-body post-right custom-scroll"><h1 class="font-bold text-4xl">Testing with flask</h1> <div class="nuxt-content"><p>Having used Rails (and Django) in the past, and after reading The Rails 5
Way, I got a bit used to the ruling principles of Rails: opinionated and
convention over configuration. Whether you like it or not, there is a way to
do things, and you'll have to follow the rules (or leave).</p>
<p>In a way, this is a real time and energy saver.
No need to argue with anyone about the pros and the cons of whatever the
possible toolkits to do whatever common task associated with web development.
No need to argue about other trivialities such as the most appropriate directory
structure to save the codes for your models.</p>
<p>When you inherit a Rails project, either you know Rails and you know where you
can expect to find stuff, or you don't know Rails and you first read The Rails Way.</p>
<p>I've been spoon-fed by Rails. Having done a few projects using Node, I knew about
the other <em>way</em> to build a server: the way in which you can afford (the cost?)
to choose the most appropriate solution for your problem, or roll up your own,
the <em>way</em> for which there was no easy one-Google-search-away solution.</p>
<p>That's when I met with Flask. God, did the world change.</p>
<p>How should I do <em>X</em>? Well who knows? Is there any best practice?
Well not really. Maybe something alike best practice specific to Flask
exists somewhere. I would like to be proven wrong.</p>
<p>So I wanted to test a flask application.
I could not find much resources.</p>
<p>After choosing a test framework (pytest), I went on. Here is what I learned.
Though RSpec was complex, all the "plumbing" was basically already done for you.
In flask, nothing of the sort is available.</p>
<h2 id="writing-tests-with-flask"><a href="#writing-tests-with-flask" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Writing tests with flask</h2>
<h3 id="client-setup"><a href="#client-setup" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Client setup</h3>
<p>We will assume you have a <code>your_app.py</code> file defined in the root of your working
directory. This files instantiate your app. It could be as simple as the following
snippet:</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
<span class="token comment"># ...</span>
<span class="token comment"># Load config</span>
<span class="token comment"># Register blueprints / extension</span>
</code></pre></div>
<p>Let's write a test:</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token keyword">class</span> <span class="token class-name">TestLogin</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_login_page</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span>
</code></pre></div>
<p>But what is this "client" parameter?
This client parameter is a <a href="https://docs.pytest.org/en/latest/fixture.html" rel="nofollow noopener noreferrer" target="_blank">pytest fixture</a>.
Fixtures are automatically loaded a <code>conftest.py</code> in (or above) the directory
where the test is defined.</p>
<p>We'll have to starting from the Flask instance to make fixtures.
The first thing to understand is that the Flask instance is an object
like any other with which you an play around.
You can open an <code>ipython</code> session and simply import your app object and have fun
with it (this is a real debug advice)!</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token keyword">import</span> pytest

<span class="token keyword">from</span> your_app <span class="token keyword">import</span> app <span class="token keyword">as</span> _app

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">client</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Get a test client for your Flask app"""</span>
    <span class="token keyword">return</span> app<span class="token punctuation">.</span>test_client<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Yield your app with its context set up and ready"""</span>

    <span class="token keyword">with</span> _app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> _app
</code></pre></div>
<p>As you can see, a pytest fixture can return or yield an object.
If an object is yielded, the part of the function after <code>yield</code> is run
after the test finish, during the tear-down process.</p>
<p>The <code>with</code> keyword above manages the context for us.
The <code>app</code> fixture could as well be written as follows:</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token keyword">import</span> pytest

<span class="token keyword">from</span> your_app <span class="token keyword">import</span> app <span class="token keyword">as</span> _app

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Yield your app with its context set up and ready"""</span>
    <span class="token comment"># Set up: Establish an application context</span>
    ctx <span class="token operator">=</span> _app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ctx<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">yield</span> _app

    <span class="token comment"># Tear down: run this after the tests are completed</span>
    ctx<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<p>Going back to our test, it's still a bit ugly. We could write it as follows:</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> url_for

<span class="token keyword">class</span> <span class="token class-name">TestLogin</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_login_page</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Use url_for to generate the URL for the endpoint directing the route "/login".</span>
        <span class="token comment"># If you want to test the logic of user.login, there is no need to include</span>
        <span class="token comment"># the route in the tests.</span>
        response <span class="token operator">=</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"user.login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span>
</code></pre></div>
<h3 id="db-setup"><a href="#db-setup" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>DB setup</h3>
<p>Until now, it was easy! Now we need to set up the database.
The following code may be somewhat back-end specific. We will assume that you
are using SQL-Alchemy along with the <code>flask_sqlalchemy</code> extension, and that
you have only one database server as backend.</p>
<p>You will probably need to setup a test database besides a development---again something
that Rails does for you so seamlessly that you may not realize at first how it's
set up (I wonder if some Rails developer never realized that tests run on the test database haha).
You'll have to change the dev database to the test database. You'll need to update
the configuration of the app during tests. Let's go back to our app fixture.</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token keyword">import</span> pytest
<span class="token keyword">from</span> your_app <span class="token keyword">import</span> app <span class="token keyword">as</span> _app

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Append "_test" to the name of the DB used for tests</span>
    db_uri <span class="token operator">=</span> _app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SQLALCHEMY_DATABASE_URI"</span><span class="token punctuation">]</span>
    test_db_uri <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>db_uri<span class="token punctuation">}</span></span><span class="token string">_test"</span></span>
    _app<span class="token punctuation">.</span>update<span class="token punctuation">(</span>SQLALCHEMY_DATABASE_URI<span class="token operator">=</span>test_db_uri<span class="token punctuation">)</span>

    <span class="token keyword">with</span> _app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> _app
</code></pre></div>
<p>Ok, so now our app is configure to run tests on a test database!
Let's set up a DB context. I will assume you defined your instance of <code>flask_sqlalchemy.SQLAlchemy</code> as <code>db</code> in <code>your_app.py</code>.
<code>your_app.py</code> may now look like this:</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>init_app<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token comment"># ...</span>
</code></pre></div>
<p>Next, let's define our db fixture:</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token keyword">import</span> pytest
<span class="token keyword">from</span> your_app <span class="token keyword">import</span> db <span class="token keyword">as</span> _db

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">db</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Even though the "app" fixture is not used in this function, the context</span>
    <span class="token comment"># of the app object need to be loaded for everything to work smoothly. Ugh...</span>

    <span class="token comment"># We clean up the database before running each unit test</span>
    _db<span class="token punctuation">.</span>drop_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
    _db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> _db
</code></pre></div>
<p>And then you can define the fixtures for your models!</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token keyword">import</span> pytest
<span class="token keyword">from</span> your_app <span class="token keyword">import</span> MyModel

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">my_model</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Set up</span>
    model <span class="token operator">=</span> MyModel<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"Foo Bar"</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>model<span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> model
</code></pre></div>
<h3 id="fixtures-a-bit-more-in-depth"><a href="#fixtures-a-bit-more-in-depth" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Fixtures a bit more in depth</h3>
<p>I can hear you from here. <strong>"But my tests are so zetta slow!!!"</strong></p>
<p>Well, if you want your tests to be faster and if you cannot afford to use an
in-memory SQLite DB for your tests, then the plumbing will have to get more
complex.</p>
<p>The <code>db</code> fixture above is called for every unit test. Basically, that means
you are dropping and creating the database for <em>every</em> test.</p>
<p>Personnaly, if I did not care about speed, I would stay in slow land, as
it really becomes messy to keep a coherent database accross tests.</p>
<p>We'll have to again change our <code>app</code> and <code>db</code> fixtures so that the same
object be used for all tests. Thus, pytest will not have to intantiate a new fixture for
each test and drop/create the DB for every function.
Thankfully, pytest supports test scopes. Let's use them.</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token comment"># When setting the scope to "session", the objects will be instantiated only once</span>
<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"session"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    db_uri <span class="token operator">=</span> _app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SQLALCHEMY_DATABASE_URI"</span><span class="token punctuation">]</span>
    test_db_uri <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>db_uri<span class="token punctuation">}</span></span><span class="token string">_test"</span></span>
    _app<span class="token punctuation">.</span>update<span class="token punctuation">(</span>SQLALCHEMY_DATABASE_URI<span class="token operator">=</span>test_db_uri<span class="token punctuation">)</span>

    <span class="token keyword">with</span> _app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> _app

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"session"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">db</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">:</span>
    _db<span class="token punctuation">.</span>drop_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
    _db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> _db
</code></pre></div>
<p>However, now we must pay attention to spill-over between tests. So we need to
apply a strict pattern for our fixtures.
In my opinion, most fixtures for your models should obey this following pattern:</p>
<ol>
<li>Set up</li>
<li>Yield</li>
<li>Tear down</li>
</ol>
<p>Here is the result:</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token keyword">import</span> pytest
<span class="token keyword">from</span> your_app <span class="token keyword">import</span> MyModel

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">my_model</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Set up</span>
    model <span class="token operator">=</span> MyModel<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"Foo Bar"</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>model<span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">yield</span> model

    <span class="token comment"># Tear down</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>model<span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<p>Now we are deleting all the fixtures that are created in-between tests.
However, this will not delete the records that your tests may create.
That's why you may as well create a scoped session for your tests (if your DB
back-end supports it, e.g. PostgreSQL).</p>
<div class="nuxt-content-highlight"><pre class="language-py line-numbers"><code><span class="token keyword">import</span> pytest

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">session</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">:</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>begin_nested<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">yield</span> db<span class="token punctuation">.</span>session

    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<p>(Thanks to this <a href="https://stackoverflow.com/questions/26555125/rollback-transactions-not-working-with-py-test-and-flask#26624146" rel="nofollow noopener noreferrer" target="_blank">SO post</a>)</p>
<p>If you do use the "session" fixture though, you will have to thoroughly use the
session fixture in each of your tests that touch the DB. Beware of failures!</p></div> <div class="w-full px-2 xs:mb-6 md:mb-12 article-card"><a href="/en/blog/author/olivier" class="flex transition-shadow duration-150 ease-in-out shadow-sm hover:shadow-md xxlmax:flex-col"><img src="/img/authors/pic-malik-olivier-boussejra.png" class="h-48 xxlmin:w-1/2 xxlmax:w-full object-cover"> <div class="flex flex-col m-4"><h4 class="font-semibold">Author</h4> <p>Malik Olivier Boussejra</p> <p>CTO at Epigno</p></div></a></div> <div class="flex justify-between mt-8"><span> </span> <span> </span></div> <footer class="flex justify-center border-gray-500 border-t-2"><p class="mt-4"><a href="https://epigno.jp" class="font-bold hover:underline"> Epigno </a></p></footer></div></article></div></div></div><script>window.__NUXT__={staticAssetsBase:"/_nuxt/static/1606899476",layout:"default",error:null,serverRendered:!0,routePath:"/en/blog/testing-with-flask",config:{content:{dbHash:"252b1c5d"}}}</script><script src="/_nuxt/ad43ec5.js" defer></script><script src="/_nuxt/f1915da.js" defer></script><script src="/_nuxt/6f44278.js" defer></script><script src="/_nuxt/2c6fc93.js" defer></script><script src="/_nuxt/beb60f5.js" defer></script>
  </body>
</html>
