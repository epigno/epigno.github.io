__NUXT_JSONP__("/en/blog/testing-with-flask", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by){return {data:[{article:{title:"Testing with flask",description:"Ramblings about testing with flask",author:{name:"Malik Olivier Boussejra",slug:"olivier",bio:"CTO at Epigno",img:"\u002Fimg\u002Fauthors\u002Fpic-malik-olivier-boussejra.png"},createdAt:am,updatedAt:am,tags:[ab,an],toc:[{id:ao,depth:2,text:ap},{id:aq,depth:ac,text:ar},{id:as,depth:ac,text:at},{id:au,depth:ac,text:av}],body:{type:"root",children:[{type:b,tag:k,props:{},children:[{type:a,value:"Having used Rails (and Django) in the past, and after reading The Rails 5\nWay, I got a bit used to the ruling principles of Rails: opinionated and\nconvention over configuration. Whether you like it or not, there is a way to\ndo things, and you'll have to follow the rules (or leave)."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"In a way, this is a real time and energy saver.\nNo need to argue with anyone about the pros and the cons of whatever the\npossible toolkits to do whatever common task associated with web development.\nNo need to argue about other trivialities such as the most appropriate directory\nstructure to save the codes for your models."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"When you inherit a Rails project, either you know Rails and you know where you\ncan expect to find stuff, or you don't know Rails and you first read The Rails Way."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"I've been spoon-fed by Rails. Having done a few projects using Node, I knew about\nthe other "},{type:b,tag:Q,props:{},children:[{type:a,value:aw}]},{type:a,value:" to build a server: the way in which you can afford (the cost?)\nto choose the most appropriate solution for your problem, or roll up your own,\nthe "},{type:b,tag:Q,props:{},children:[{type:a,value:aw}]},{type:a,value:" for which there was no easy one-Google-search-away solution."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"That's when I met with Flask. God, did the world change."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"How should I do "},{type:b,tag:Q,props:{},children:[{type:a,value:"X"}]},{type:a,value:"? Well who knows? Is there any best practice?\nWell not really. Maybe something alike best practice specific to Flask\nexists somewhere. I would like to be proven wrong."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"So I wanted to test a flask application.\nI could not find much resources."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"After choosing a test framework (pytest), I went on. Here is what I learned.\nThough RSpec was complex, all the \"plumbing\" was basically already done for you.\nIn flask, nothing of the sort is available."}]},{type:a,value:f},{type:b,tag:"h2",props:{id:ao},children:[{type:b,tag:N,props:{href:"#writing-tests-with-flask",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:ap}]},{type:a,value:f},{type:b,tag:ad,props:{id:aq},children:[{type:b,tag:N,props:{href:"#client-setup",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:ar}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"We will assume you have a "},{type:b,tag:l,props:{},children:[{type:a,value:ae}]},{type:a,value:" file defined in the root of your working\ndirectory. This files instantiate your app. It could be as simple as the following\nsnippet:"}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:" Flask\n\napp "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:ax},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:ay},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:az}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# Load config"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# Register blueprints \u002F extension"}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Let's write a test:"}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aA}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,aB]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aF}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:aG},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"\u002Flogin\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aI}]},{type:a,value:aJ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aK},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:aL}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,aM]},children:[{type:a,value:aN}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"But what is this \"client\" parameter?\nThis client parameter is a "},{type:b,tag:N,props:{href:"https:\u002F\u002Fdocs.pytest.org\u002Fen\u002Flatest\u002Ffixture.html",rel:[aO,aP,aQ],target:aR},children:[{type:a,value:"pytest fixture"}]},{type:a,value:".\nFixtures are automatically loaded a "},{type:b,tag:l,props:{},children:[{type:a,value:"conftest.py"}]},{type:a,value:" in (or above) the directory\nwhere the test is defined."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"We'll have to starting from the Flask instance to make fixtures.\nThe first thing to understand is that the Flask instance is an object\nlike any other with which you an play around.\nYou can open an "},{type:b,tag:l,props:{},children:[{type:a,value:"ipython"}]},{type:a,value:" session and simply import your app object and have fun\nwith it (this is a real debug advice)!"}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:W}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,C,D,e]},children:[{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"client"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,ai,s]},children:[{type:a,value:"\"\"\"Get a test client for your Flask app\"\"\""}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Y}]},{type:a,value:" app"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"test_client"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"\n\n"},{type:b,tag:c,props:{className:[d,C,D,e]},children:[{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,ai,s]},children:[{type:a,value:aS}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Z}]},{type:a,value:P},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:L}]},{type:a,value:aT}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"As you can see, a pytest fixture can return or yield an object.\nIf an object is yielded, the part of the function after "},{type:b,tag:l,props:{},children:[{type:a,value:L}]},{type:a,value:" is run\nafter the test finish, during the tear-down process."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:aU},{type:b,tag:l,props:{},children:[{type:a,value:Z}]},{type:a,value:" keyword above manages the context for us.\nThe "},{type:b,tag:l,props:{},children:[{type:a,value:G}]},{type:a,value:" fixture could as well be written as follows:"}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:W}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,C,D,e]},children:[{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,ai,s]},children:[{type:a,value:aS}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# Set up: Establish an application context"}]},{type:a,value:"\n    ctx "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:P},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aV},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"push"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:L}]},{type:a,value:" _app\n\n    "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# Tear down: run this after the tests are completed"}]},{type:a,value:aV},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"pop"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Going back to our test, it's still a bit ugly. We could write it as follows:"}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:" url_for\n\n"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aA}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,aB]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aF}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# Use url_for to generate the URL for the endpoint directing the route \"\u002Flogin\"."}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# If you want to test the logic of user.login, there is no need to include"}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# the route in the tests."}]},{type:a,value:aG},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"url_for"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"user.login\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aI}]},{type:a,value:aJ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aK},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:aL}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,aM]},children:[{type:a,value:aN}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:ad,props:{id:as},children:[{type:b,tag:N,props:{href:"#db-setup",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:at}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Until now, it was easy! Now we need to set up the database.\nThe following code may be somewhat back-end specific. We will assume that you\nare using SQL-Alchemy along with the "},{type:b,tag:l,props:{},children:[{type:a,value:"flask_sqlalchemy"}]},{type:a,value:" extension, and that\nyou have only one database server as backend."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"You will probably need to setup a test database besides a development---again something\nthat Rails does for you so seamlessly that you may not realize at first how it's\nset up (I wonder if some Rails developer never realized that tests run on the test database haha).\nYou'll have to change the dev database to the test database. You'll need to update\nthe configuration of the app during tests. Let's go back to our app fixture."}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:W}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,C,D,e]},children:[{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# Append \"_test\" to the name of the DB used for tests"}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:P},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aX},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aY}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:aZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:a_}]},{type:a,value:a$},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,ba]},children:[{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bb}]},{type:b,tag:c,props:{className:[d,bc]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:bd}]},{type:a,value:be},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:bf}]}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bg}]}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Z}]},{type:a,value:P},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:L}]},{type:a,value:aT}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Ok, so now our app is configure to run tests on a test database!\nLet's set up a DB context. I will assume you defined your instance of "},{type:b,tag:l,props:{},children:[{type:a,value:"flask_sqlalchemy.SQLAlchemy"}]},{type:a,value:" as "},{type:b,tag:l,props:{},children:[{type:a,value:K}]},{type:a,value:" in "},{type:b,tag:l,props:{},children:[{type:a,value:ae}]},{type:a,value:".\n"},{type:b,tag:l,props:{},children:[{type:a,value:ae}]},{type:a,value:" may now look like this:"}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:" Flask\n"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:" flask_sqlalchemy "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:" SQLAlchemy\n\napp "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:ax},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:ay},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"\ndb "},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:" SQLAlchemy"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"\ndb"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"init_app"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:az}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Next, let's define our db fixture:"}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:" db "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:W}]},{type:a,value:" _db\n\n"},{type:b,tag:c,props:{className:[d,C,D,e]},children:[{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:K}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# Even though the \"app\" fixture is not used in this function, the context"}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# of the app object need to be loaded for everything to work smoothly. Ugh..."}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# We clean up the database before running each unit test"}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bm},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Y}]},{type:a,value:bn}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"And then you can define the fixtures for your models!"}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:bo},{type:b,tag:c,props:{className:[d,C,D,e]},children:[{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bp}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:K},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:bq}]},{type:a,value:br},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:bs},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bt},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bv},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Y}]},{type:a,value:" model\n"}]}]}]},{type:a,value:f},{type:b,tag:ad,props:{id:au},children:[{type:b,tag:N,props:{href:"#fixtures-a-bit-more-in-depth",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:av}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"I can hear you from here. "},{type:b,tag:"strong",props:{},children:[{type:a,value:"\"But my tests are so zetta slow!!!\""}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Well, if you want your tests to be faster and if you cannot afford to use an\nin-memory SQLite DB for your tests, then the plumbing will have to get more\ncomplex."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:aU},{type:b,tag:l,props:{},children:[{type:a,value:K}]},{type:a,value:" fixture above is called for every unit test. Basically, that means\nyou are dropping and creating the database for "},{type:b,tag:Q,props:{},children:[{type:a,value:"every"}]},{type:a,value:" test."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Personnaly, if I did not care about speed, I would stay in slow land, as\nit really becomes messy to keep a coherent database accross tests."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"We'll have to again change our "},{type:b,tag:l,props:{},children:[{type:a,value:G}]},{type:a,value:" and "},{type:b,tag:l,props:{},children:[{type:a,value:K}]},{type:a,value:" fixtures so that the same\nobject be used for all tests. Thus, pytest will not have to intantiate a new fixture for\neach test and drop\u002Fcreate the DB for every function.\nThankfully, pytest supports test scopes. Let's use them."}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# When setting the scope to \"session\", the objects will be instantiated only once"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,C,D,e]},children:[{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bx}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:P},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:aX},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aY}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:aZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:a_}]},{type:a,value:a$},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,ba]},children:[{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bb}]},{type:b,tag:c,props:{className:[d,bc]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:bd}]},{type:a,value:be},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:bf}]}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bg}]}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Z}]},{type:a,value:P},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:L}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,C,D,e]},children:[{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bx}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:K}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bm},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Y}]},{type:a,value:bn}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"However, now we must pay attention to spill-over between tests. So we need to\napply a strict pattern for our fixtures.\nIn my opinion, most fixtures for your models should obey this following pattern:"}]},{type:a,value:f},{type:b,tag:"ol",props:{},children:[{type:a,value:f},{type:b,tag:al,props:{},children:[{type:a,value:"Set up"}]},{type:a,value:f},{type:b,tag:al,props:{},children:[{type:a,value:"Yield"}]},{type:a,value:f},{type:b,tag:al,props:{},children:[{type:a,value:"Tear down"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Here is the result:"}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:bo},{type:b,tag:c,props:{className:[d,C,D,e]},children:[{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bp}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:K},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:bq}]},{type:a,value:br},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:a,value:bs},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bt},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:bv},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:L}]},{type:a,value:" model\n\n    "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"# Tear down"}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"delete"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Now we are deleting all the fixtures that are created in-between tests.\nHowever, this will not delete the records that your tests may create.\nThat's why you may as well create a scoped session for your tests (if your DB\nback-end supports it, e.g. PostgreSQL)."}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:l,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:p}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,C,D,e]},children:[{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:z}]},{type:a,value:o},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:K},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:M},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"begin_nested"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:H},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:L}]},{type:a,value:" db"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"session\n\n    db"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:I},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:"rollback"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"(Thanks to this "},{type:b,tag:N,props:{href:"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F26555125\u002Frollback-transactions-not-working-with-py-test-and-flask#26624146",rel:[aO,aP,aQ],target:aR},children:[{type:a,value:"SO post"}]},{type:a,value:i}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"If you do use the \"session\" fixture though, you will have to thoroughly use the\nsession fixture in each of your tests that touch the DB. Beware of failures!"}]}]},dir:"\u002Farticles\u002Fen",path:"\u002Farticles\u002Fen\u002Ftesting-with-flask",extension:".md",slug:"testing-with-flask"},tags:{python:{name:ab,slug:ab},"web development":{name:an,slug:"web_development"}},prev:by,next:by,availableLocales:[]}],fetch:[],mutations:void 0}}("text","element","span","token","punctuation","\n","keyword",".",")","(","p","code","operator","="," ","import","comment",":","string","div","nuxt-content-highlight","pre","language-py","line-numbers","\n    ","def","function","from","decorator","annotation","@pytest","fixture","app","\n\n    ","session","\n        ","db","yield","\n    db","a"," your_app "," _app","em","true",-1,"icon","icon-link"," client","as"," _app\n\n","return","with","app_context"," pytest\n","\n    _db","python",3,"h3","your_app.py"," flask "," pytest\n\n"," app ","triple-quoted-string","model","commit","li","2018-08-01T00:00:00.000Z","web development","writing-tests-with-flask","Writing tests with flask","client-setup","Client setup","db-setup","DB setup","fixtures-a-bit-more-in-depth","Fixtures a bit more in depth","way"," Flask","__name__","# ...","class","class-name","TestLogin","test_login_page","self",",","\n        response ","get","assert"," response","status_code ","==","number","200","nofollow","noopener","noreferrer","_blank","\"\"\"Yield your app with its context set up and ready\"\"\""," _app\n","The ","\n    ctx","\n    db_uri ","config","[","\"SQLALCHEMY_DATABASE_URI\"","]","\n    test_db_uri ","string-interpolation","f\"","interpolation","{","db_uri","}","_test\"","\n    _app","update","SQLALCHEMY_DATABASE_URI","test_db_uri","drop_all","create_all"," _db\n"," MyModel\n\n","my_model","# Set up","\n    model "," MyModel","name","\"Foo Bar\"","add","scope","\"session\"",null)));