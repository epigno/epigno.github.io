__NUXT_JSONP__("/blog/mysql-dump-single-transaction", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){return {data:[{article:{slug:"mysql-dump-single-transaction",description:"MySQLのデータベースをより安全にダンプするための方法を紹介します．",title:"MySQLのデータベースをトランザクション内でダンプする",img:"\u002Fimg\u002Fmysql.png",alt:"MySQL",author:{name:"Malik Olivier Boussejra",slug:"olivier",bio:"CTO at Epigno",img:"\u002Fimg\u002Fauthors\u002Fpic-malik-olivier-boussejra.jpg"},tags:[n],toc:[],body:{type:"root",children:[{type:b,tag:e,props:{},children:[{type:a,value:"MySQLのデータベースをダンプする際，"},{type:b,tag:c,props:{},children:[{type:a,value:f}]},{type:a,value:" の "},{type:b,tag:g,props:{href:o,rel:[h,i,j],target:k},children:[{type:b,tag:c,props:{},children:[{type:a,value:m}]},{type:a,value:p}]},{type:a,value:" を用いることで，ダンプ処理全体をトランザクションで囲むことができます．\n今回，ダンプをトランザクションで囲むメリットについて話そうと思います．"}]},{type:a,value:d},{type:b,tag:e,props:{},children:[{type:a,value:"MySQLでデータベースをダンプする際，"},{type:b,tag:g,props:{href:"https:\u002F\u002Fdev.mysql.com\u002Fdoc\u002Frefman\u002F8.0\u002Fen\u002Fmysqldump.html",rel:[h,i,j],target:k},children:[{type:b,tag:c,props:{},children:[{type:a,value:f}]}]},{type:a,value:" というユーティリティはよく使われます．\n一般的に，下記のように使います．"}]},{type:a,value:d},{type:b,tag:q,props:{className:[r]},children:[{type:b,tag:s,props:{className:[t,u]},children:[{type:b,tag:c,props:{},children:[{type:a,value:"mysqldump --result-file=output.sql databasename --user=username\n"}]}]}]},{type:a,value:d},{type:b,tag:e,props:{},children:[{type:b,tag:c,props:{},children:[{type:a,value:f}]},{type:a,value:" は，デフォルトでテーブルをロックしているってご存知でしたか？\n"},{type:b,tag:c,props:{},children:[{type:a,value:f}]},{type:a,value:" のドキュメンテーションを確認してみましょう．"}]},{type:a,value:d},{type:b,tag:v,props:{},children:[{type:a,value:d},{type:b,tag:e,props:{},children:[{type:b,tag:c,props:{},children:[{type:a,value:f}]},{type:a,value:" requires at least the "},{type:b,tag:c,props:{},children:[{type:a,value:w}]},{type:a,value:" privilege for dumped tables,\n"},{type:b,tag:c,props:{},children:[{type:a,value:"SHOW VIEW"}]},{type:a,value:" for dumped views, "},{type:b,tag:c,props:{},children:[{type:a,value:"TRIGGER"}]},{type:a,value:" for dumped triggers,\n"},{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{},children:[{type:a,value:l}]},{type:a,value:y},{type:b,tag:c,props:{},children:[{type:a,value:m}]},{type:a,value:" option is not used"}]},{type:a,value:",\nand (as of MySQL 8.0.21) "},{type:b,tag:c,props:{},children:[{type:a,value:"PROCESS"}]},{type:a,value:y},{type:b,tag:c,props:{},children:[{type:a,value:"--no-tablespaces"}]},{type:a,value:" option is not used.\n[引用者強調]"}]},{type:a,value:d}]},{type:a,value:d},{type:b,tag:e,props:{},children:[{type:a,value:"テーブルをロックすると，ダンプ中，他のSQLセッションはテーブルを読み取れません．無論，書き込みもできません．\nドキュメンテーションにもその挙動が"},{type:b,tag:g,props:{href:"https:\u002F\u002Fdev.mysql.com\u002Fdoc\u002Frefman\u002F8.0\u002Fen\u002Fprivileges-provided.html#priv_lock-tables",rel:[h,i,j],target:k},children:[{type:a,value:"記載されています"}]},{type:a,value:"．"}]},{type:a,value:d},{type:b,tag:v,props:{},children:[{type:a,value:d},{type:b,tag:e,props:{},children:[{type:b,tag:c,props:{},children:[{type:a,value:l}]}]},{type:a,value:d},{type:b,tag:e,props:{},children:[{type:a,value:"Enables use of explicit "},{type:b,tag:c,props:{},children:[{type:a,value:l}]},{type:a,value:" statements to lock tables for which you have the "},{type:b,tag:c,props:{},children:[{type:a,value:w}]},{type:a,value:" privilege. This includes use of write locks, "},{type:b,tag:x,props:{},children:[{type:a,value:"which prevents other sessions from reading the locked table"}]},{type:a,value:".\n[引用者強調]"}]},{type:a,value:d}]},{type:a,value:d},{type:b,tag:e,props:{},children:[{type:a,value:"つまり，巨大なテーブルのダンプを不用意に開始すると，アプリケーション全体が停止してしまう危険性があります．\nまずいですよね．www"}]},{type:a,value:d},{type:b,tag:e,props:{},children:[{type:a,value:"その上，"},{type:b,tag:c,props:{},children:[{type:a,value:l}]},{type:a,value:" はテーブル１つ１つに対して行われるので，"},{type:b,tag:c,props:{},children:[{type:a,value:f}]},{type:a,value:" をそのまま使うと，テーブル同士のデータの一貫性を担保できません．"}]},{type:a,value:d},{type:b,tag:e,props:{},children:[{type:b,tag:g,props:{href:o,rel:[h,i,j],target:k},children:[{type:b,tag:c,props:{},children:[{type:a,value:m}]},{type:a,value:p}]},{type:a,value:"で，ダンプ処理をトランザクションで囲むことにより，"},{type:b,tag:c,props:{},children:[{type:a,value:l}]},{type:a,value:" が発生しなくなり，アプリケーションを停止させずにダンプすることができます．\nまた，トランザクションのおかげでテーブル同士のデータの一貫性も担保できます．\n上記を踏まえ，これからは "},{type:b,tag:g,props:{href:o,rel:[h,i,j],target:k},children:[{type:b,tag:c,props:{},children:[{type:a,value:m}]},{type:a,value:p}]},{type:a,value:" を使って，下記のように運用データベースをダンプしましょう．"}]},{type:a,value:d},{type:b,tag:q,props:{className:[r]},children:[{type:b,tag:s,props:{className:[t,u]},children:[{type:b,tag:c,props:{},children:[{type:a,value:"mysqldump --result-file=output.sql databasename --user=username --single-transaction\n"}]}]}]}]},dir:"\u002Farticles\u002Fja",path:"\u002Farticles\u002Fja\u002Fmysql-dump-single-transaction",extension:".md",createdAt:z,updatedAt:z},tags:{mysql:{slug:n,name:n}},prev:{slug:"military-terms-in-computer-science",title:"情報工学の用語に軍由来のものが多いという話"},next:{slug:"rust-profiling",title:"valgrindを使ってRustのコードをプロファイリングする"},availableLocales:[]}],fetch:[],mutations:void 0}}("text","element","code","\n","p","mysqldump","a","nofollow","noopener","noreferrer","_blank","LOCK TABLES","--single-transaction","mysql","https:\u002F\u002Fdev.mysql.com\u002Fdoc\u002Frefman\u002F8.0\u002Fen\u002Fmysqldump.html#option_mysqldump_single-transaction"," フラグ","div","nuxt-content-highlight","pre","language-text","line-numbers","blockquote","SELECT","strong"," if the ","2021-11-18T22:08:06.292Z")));